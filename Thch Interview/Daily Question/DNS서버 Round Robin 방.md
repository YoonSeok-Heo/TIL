# DNS서버 Round Robin방식

Round Robin이란? DNS서버 구성 방식중 하나이다.

시분할 시스템을 위해 설계된 선점형 스케줄링으로, 프로세스들 사이에 우선순위를 두지 않고 순서대로 CPU를 할당하는 방식의 CPU 스케줄링 알고리즘이다.

각 프로세스에 일정시간을 할당하고, 할당된 시간이 지나면 그 프로세스는 잠시 보류한 뒤 다른 프로세스에게 기회를 주는 방식으로 돌아가며 기회를 부여하는 방식이다..

즉 DNS서버에 대한 Round Robin형식으로 구성할 경우 로드 밸런서가 필요가 없으며 부하에 대한 걱정을 할 필요가 없다는 뜻이다. (시간에 따라 스케쥴링이 변환되기 때문에

### 단점

1. 서버 수 만큼 공인 IP주소가 필요하다.
    - 부하 분산을 위해 서버의 대수를 늘리기 위해서 그 만큼의 공인 IP가 필요하다.
2. 균등하게 분산되지 않는다.
    - 모바일 사이트 등에서 문제가 될 수 있는데, 스마트폰의 접속은 캐리어 게이트웨이라고 하는 프록시 서버를 경우한다. 프록시 서버는 이름 변환 결과가 일정 시간 동안 캐싱되므로 같은 프록시 서버를 경유하는 접속은 항상 같은 서버로 접속된다.
    - PC용 웹 브라우저도 DNS질의 결과를 캐싱하기 때문에 균등하게 분산되지 않는다.
    - DNS레코드의 TTL값을 짧게 설정하면 어느정도 해소 되지만 TTL에 따라 캐시를 해제하는 것은 아니므로 주의가 필요하다.
3. 서버가 다운되도 확인이 불가능하다. 
    - DNS서버는 웹 서버의 부하나 접속 수 등의 상황에 따라 질의결과를 제어할 수 없다.
    - 웹 서버의 부하가 높아서 응답이 느려지거나 접속수가 꽉 차서 접속을 처리할 수 없는 상환인지 감지할 수 없어서 다운되더라도 이를 검출하지 못하고 유저들에게 제공된다.
    - 이때문에 간혹 다운된 서버로 연결이 되기도 한다.
    - DNS 라운드 로빈은 어디까지나 부하분산 을 위한 방법이지 다중화 방법은 아니므로 다른 S/W 와 조합해서 관리할 필요가 있다.

### 해결방안
- 다중화 구성 방식(Synchronous Time-Division Multiplexing)


    AP 서버에 VIP(Virtual IP)를 부여해서 다중화를 구성한다. 각 AP 서버를 Health Check후 이상이 감지되면 VIP를 정상 AP 서버로 인계하는 방식을 사용한다.
    즉 DNS Server Table 에 실시간으로 AP 서버의 상태를 확인할 수 있는 칼럼 및 함수를 추가하여 요청될 경우 서버 상태를 확인하여 우회루트를 제공하거나 에러를 전송하는 방식을 말합니다.
  
- 가중치 편성 방식 (Weighted round robin)


    각각의 웹 서버에 가중치를 가미해서 분산 비율을 변경한다. 물론 가중치가 큰 서버일수록 빈번하게 선택되므로 처리능력이 높은 서버는 가중치를 높게 설정하는 것이 좋다.

- 최소 연결 방식 (Least connection)
    접속 클라이언트 수가 가장 적은 서버를 선택한다. 로드밸런서에서 실시간으로 connection 수를 관리하거나 각 서버에서 주기적으로 알려주는 것이 필요하다.
