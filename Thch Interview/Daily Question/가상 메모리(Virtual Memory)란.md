# 가상 메모리(Virtual Memory)

PC에는 Main memory(RAM)이 있는데 RAM은 가격이 비싸다. 가격이 비싼만큼 충분한 용량을 구비하기 힘들고 RAM이 부족한 순간이온다. 이 때 하드디스크까지 Main memory를 확장해서 사용하는 것을 Virtual Memory기법이라고 한다.

## 물리 주소와 가상 주소
물리주소는 Main memory(RAM)에만 존재하는 것이다. 
가상주소는 하드디스크까지 메모리를 확장했을 때 얻을 수 있는 값을 의미한다.

### 물리주소와 가상주소가 어떻게 동작하는지 살펴보자.
Main memory가 16KB 크기를 가진다고 가정.

![image](https://user-images.githubusercontent.com/113662725/220358573-7114c774-f274-4bb1-ac39-60c3b7b09672.png)

CPU가 가상메모리에서 어떤 주소를 할당해달라고 요청하면, MMU(memory management unit)가 요청을 처리해서 물리주소에 넣는다.

- 1KB부터 20Kbyte를 요청받았다면, 블록을 4KB 단위로 잘라서 할당한다.
- 가상메모리의 블록단위를 페이지(page)라고 하고 물리메모리의 블록단위를 페이지 프래임(page frame)이라고 한다.(둘의 크기는 동일)

#### Main memory보다 더 큰 사이즈의 요청이 들어오면 어떻게 될까?

![image](https://user-images.githubusercontent.com/113662725/220366082-dca7801e-d31d-416e-9676-76626b785d9b.png)

물리적 주소에는 36KB가 들어갈 자리는 없지만, 마치 36KB의 자리가 있는 것처럼 빈 공간(4KB)에 들어가서 사용하게된다. 이것이 가상메모리의 핵심이다.

#### MMU의 역할을 무엇일까?
만약 CPU가 MMU에 36KB의 가상메모리가 어딨는지 요청한다면, 실제 물리주소의 4KB의 주소에 저장했다라고 기억하고 그 주소로 찾아가서 반환을 해야한다.

이 과정을 일반화 하면, 가상주소를 물리주소로 변환하는 작업인 **주소변환**이 된다.

#### CPU의 관점도 프로그래머와 같다.
우리가 가상메모리를 사용하면 정말 그 만큼의 메모리가 존재한다고 생각하면서 사용할 수 있는 것처럼, CPU도 똑같이 생각하고 명령을 내리고, MMU가 알아서 물리주소로 주소변환을 해준다.

## 요약
- 가상메모리는 메모리가 부족할경우 보조기억장치를 램처럼 사용하도록 만들어준다!

