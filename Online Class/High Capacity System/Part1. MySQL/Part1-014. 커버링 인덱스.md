# 커버링 인덱스

## 커버링 인덱스의 기본 개념
SQL이 들어오게 되면 인덱스를 거쳐서 테이블에 접근하는 것이 빠르다.
- 검색조건이 인덱스에 부합하다면, 테이블에 바로 접근 하는 것보다 인덱스를 통해 접근하는 것이 매우 빠르다. 

**그렇다면 테이블에 접근하지 않고 인덱스로만 데이터 응답을 내려줄 순 없을까??**

## 예시
**회원 테이블**

|데이터 주소|이름|성별|나이|직업|
|---|---|---|---|---|
|1|홍길동|남|32|경찰|
|2|김천사|여|27|목사|
|3|이순신|남|19|어부|
|4|김철수|남|25|개발자|

**인덱스 테이블**

| 나이 |데이터 주소|
|----|---|
| 19 |3|
| 27 |2|
| 32 |1|
| 45 |4|
---
```sql
SELECT 나이
FROM 회원
WHERE 나이 < 30
```

- SELECT에서 필요한 데이터가 '나이'하나이기 때문에 따로 테이블에 접근하지 않고 인덱스 테이블만 확인한다.

| 나이                                    |데이터 주소|
|---------------------------------------|---|
| <span style="color:red">**19**</span> |3|
| <span style="color:red">**27**</span> |2|
| 32                                    |1|
| 45                                    |4|

---
```sql
SELECT 나이, id
FROM 회원
WHERE 나이 < 30
```
- id값 또한 인덱스에 포함되기 때문에 커버링 인덱스처럼 동작한다.

| 나이                                    | 데이터 주소                               |
|---------------------------------------|--------------------------------------|
| <span style="color:red">**19**</span> | <span style="color:red">**3**</span> |
| <span style="color:red">**27**</span> | <span style="color:red">**2**</span> |
| 32                                    | 1                                    |
| 45                                    | 4                                    |

---

**※ MySql에서는 PK가 클러스터 인덱스이기 때문에 커버링 인덱스에 유리**


## 커버링 인덱스로 페이지네이션 최적화를 어떻게 할 수 있을까?

나이가 30 이하인 회원의 이름을 2개만 조회

```sql
with 커버링 as(
    SELECT id
    FROM 회원
    WHERE 나이 < 30
    LIMIT 2
)

SELECT 이름 
FROM 회원 INNER JOIN 커버링 on 회원.id = 커버링.id
```
가상 테이블을 만들고 inner join을 한다.

**※ order by, offset, limit 절로 인한 불필요한 데이터블록 접근을 커버링 인덱스를 통해 최소화**