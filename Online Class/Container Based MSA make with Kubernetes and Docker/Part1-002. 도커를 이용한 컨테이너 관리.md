# 2. 도커를 이용한 컨테이너 관리

## 2.1. 도커 이미지와 컨테이너

### 2.1.1. 도커 구성요소

![image](https://user-images.githubusercontent.com/113662725/234806129-fa8fe3b4-33e6-48f5-b0d7-c6c4b7d8265f.png)

### 2.1.2. 도커 이미지와 컨테이너

- 이미지와 컨테이너는 도커에서 사용하는 가장 기본적인 단위
- 이미지와 컨테이너는 1 : N 관계

|이미지(Image)|컨테이너(Container)|
|---|---|
|- 이미지는 컨테이너를 생성할 때 필요한 요소로<br>컨테이너의 목적에 맞는 바이너리와 의존성이 설치되어 있음<br>- 여러 개의 계층으로 된 바이너리 파일로 존재|- 호스트와 다른 컨테이너로부터 격리된 시스템 <br>자원과 네트워크를 사용하는 프로세스<br>- 이미지는 읽기 전용으로 사용하여 변경사항은<br>컨테이너 계층에 저장<br>※ 컨테이너에서 무엇을 하든 이미지는 영향 받지 않음|

![image](https://user-images.githubusercontent.com/113662725/234807849-5bdd2b1e-4f0d-4430-8ab1-0eeb3a6ea8d6.png)

### 2.1.3. 도커 이미지 이름 구성
1. 저장소 이름(Repository Name)
2. 이미지 이름(Image Name)
3. 이미지 태그(Image Tag)

> ※ 도커 이미지 Pull/Push시에 저장소 이름을 생략하면 기본 저장소인 도커 허브로 인식
> 
> ※ 도커 이미지 태그를 생략하면 리비전을 가리키는 lastest로 인식

---

## 2.2. 도커 컨테이너 다루기: 컨테이너 라이프사이클

![image](https://user-images.githubusercontent.com/113662725/235131730-e7b25e60-111e-488f-8878-c7a164a3221c.png)

---

![image](https://user-images.githubusercontent.com/113662725/235131871-190e0129-e12f-4673-97e6-26735e1a16e6.png)

### 2.2.1. 컨테이너 시작

도커 create / run 명령어 모두 이미지가 없을 경우 자동으로 pull을 먼저 수행하여 이미지를 다운로드 받음

#### 컨테이너 생성
```console
$ docker create [image]
```

#### 컨테이너 생성 및 시작
```console
$ docker run [image]
```

#### 컨테이너 시작
```console
$ docker start [container]
```

### 2.2.2. 컨테이너 시작 주요 옵션
```console
$ docker run \                          
    -i \                                # 호스트의 표준 입력을 컨테이너와 연결 (interactive)
    -t \                                # TTY 할당
    --rm \                              # 컨테이너 실행 종료 후 자동 삭제
    -d \                                # 백그라운드 모드로 실행 (detache)
    --name hello-world \                # 컨테이너 이름 지정
    -p 80:80 \                          # 호스트 - 컨테이너 간 포트 바인딩
    -v /opt/example:/example \          # 호스트 - 컨테이너 간 볼륨 바인딩
    fastcampus/hello-world:lastest \    # 실행할 이미지
    my-command                          # 컨테이너 내에서 실행할 명령어
```

### 2.2.3. 컨테이너 상태 확인

#### 실행중인 컨테이너 상태 확인
```console
$ docker ps
```

#### 전체 컨테이너 상태 확인
```console
$ docker ps -a
```

#### 컨테이너 상세 정보 확이
```console
$ docker inspect [container]
```

### 2.2.4. 컨테이너 일시중시 및 재개

#### 컨테이너 일시 중지
```console
$ docker pause [container]
```

#### 컨테이너 재개
```console
$ docker unpause [container]
```

### 2.2.5. 컨테이너 종료

#### 컨테이너 종료 (SIGTERM 시그널 전달)
```console
$ docker stop [container]
```

#### 컨테이널 강제 종료 (SIGKILL 시그널 전달)
```console
$ docker kill [container]
```

#### 모든 컨테이너 종료
```console
$ docker stop $(docker ps -a -q)
```

### 2.2.6. 컨테이너 삭제

#### 컨테이너 삭제 (실행중인 컨테이너 불가)
```console
$ docker rm [container]
```

#### 컨테이너 강제 종료 후 삭제(SIGKILL 시그널 전달)
```console
$ docker rm -r [container]
```

#### 컨테이너 실행 종료 후 자동 삭제
```console
$ docker run --rm ...
```

#### 중지된 모든 컨테이너 삭제
```console
$ docker container prune
```

